{% extends 'apps/master.html' %} {% load static %} {% block user_profile %}
<div class="container">
    <div class="main-body">
        <!-- Form gửi dữ liệu đến server -->
        <form method="POST" id="profile-form" action="{% url 'user_profile_edit' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row gutters-sm">
                <!-- Avatar và thông tin liên hệ -->
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-column align-items-center text-center">
                                <div class="form-group">
                                    <div class="d-flex justify-content-center">
                                        {% if user.photo %}
                                        <img src="{{ user.PhotoURL }}" alt="Profile Picture" style="width: 150px; margin-top: 10px; border-radius: 50%; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);"> {% else %}
                                        <img src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}https://bootdey.com/img/Content/avatar/avatar7.png{% endif %}" alt="User Profile" class="rounded-circle" width="150" style="border: 2px solid #ddd; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">                                        {% endif %}
                                    </div>
                                    <br>
                                    <label for="photo" id="photo-label" style="display:none;">Profile Picture</label>
                                    <input type="file" id="photo" name="photo" class="form-control" style="display:none;">
                                    <br>
                                </div>
                                <div class="mt-3">
                                    <h3 class="text-secondary mb-1">{{ user.get_role_display }}</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Thông tin cá nhân -->
                <div class="col-md-8">
                    <div class="card mb-3">
                        <div class="card-body">
                            <!-- <div class="form-group">
                                <div class="d-flex justify-content-center">
                                    {% if user.photo %}
                                    <img src="{{ user.PhotoURL }}" alt="Profile Picture" style="width: 150px; margin-top: 10px; border-radius: 50%; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);"> {% else %}
                                    <img src="{% if user.profile.image %}{{ user.profile.image.url }}{% else %}https://bootdey.com/img/Content/avatar/avatar7.png{% endif %}" alt="User Profile" class="rounded-circle" width="150" style="border: 2px solid #ddd; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">                                    {% endif %}
                                </div>
                                <br>


                                <label for="photo" id="photo-label" style="display:none;">Profile Picture</label>
                                <input type="file" id="photo" name="photo" class="form-control" style="display:none;">
                                <br>
                            </div> -->
                            <!-- Full Name -->
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Full Name</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <input type="text" name="full_name" value="{{ user.get_full_name }}" class="form-control" id="full_name" readonly>
                                </div>
                            </div>
                            <hr>
                            <!-- Email -->
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Email</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <input type="email" name="email" value="{{ user.email }}" class="form-control" id="email" readonly>
                                </div>
                            </div>
                            <hr>
                            <!-- Phone -->
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Phone</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <input type="text" name="phone" value="{{ user.phone }}" class="form-control" id="phone" readonly>
                                </div>
                            </div>
                            <hr>
                            <!-- Date of Birth -->
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Date of Birth</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <input type="date" name="dob" value="{{ user.dob|date:'Y-m-d'|default:'' }}" class="form-control" id="dob" readonly>
                                </div>
                            </div>
                            <hr>
                            <!-- Gender -->
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Gender</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <select name="gender" class="form-control" id="gender" disabled>
                                        <option value="Male" {% if user.gender == "Male" %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if user.gender == "Female" %}selected{% endif %}>Female</option>
                                    </select>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Address</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <input type="type" name="address" value="{{ user.address }}" class="form-control" id="dob" readonly>
                                </div>
                            </div>
                            <hr>
                            {% comment %} Balance {% endcomment %}
                            <div class="row">
                                <div class="col-sm-3">
                                    <h6 class="mb-0">Account Balance</h6>
                                </div>
                                <div class="col-sm-9 text-secondary">
                                    <p>{{ balance|floatformat:2 }} USD</p>
                                </div>
                            </div>
                            <hr>
                    
                            <!-- Buttons -->
                            <button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'transaction_history' %}'">View Transaction</button>
                            <button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'top_up' %}'">Top-up Now</button>
                            <button type="button" class="btn btn-warning" id="edit-btn" onclick="enableEditing()">Edit</button>
                            <button type="submit" class="btn btn-success" id="save-btn" style="display:none;">Save</button>
                            <button type="button" class="btn btn-secondary" id="cancel-btn" style="display:none;" onclick="cancelEditing()">Cancel</button>
                            <button type="button" class="btn btn-danger" onclick="window.location.href='{% url 'delete_account' %}'">Delete Account</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    let originalValues = {};

    function enableEditing() {
        document.querySelectorAll('#profile-form input, #profile-form select').forEach(field => {
            field.readOnly = false;
            field.disabled = false;
            originalValues[field.name] = field.value;
        });

        document.getElementById('photo-label').style.display = 'inline-block';
        document.getElementById('photo').style.display = 'inline-block';

        document.getElementById('edit-btn').style.display = 'none';
        document.getElementById('save-btn').style.display = 'inline-block';
        document.getElementById('cancel-btn').style.display = 'inline-block';
    }

    function cancelEditing() {
        document.querySelectorAll('#profile-form input, #profile-form select').forEach(field => {
            field.value = originalValues[field.name];
            field.readOnly = true;
            field.disabled = true;
        });

        document.getElementById('photo-label').style.display = 'none';
        document.getElementById('photo').style.display = 'none';

        document.getElementById('edit-btn').style.display = 'inline-block';
        document.getElementById('save-btn').style.display = 'none';
        document.getElementById('cancel-btn').style.display = 'none';
    }
</script>
{% endblock %}