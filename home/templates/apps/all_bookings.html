{% extends 'apps/master.html' %}

{% block allBookings %}
<div class="container py-5">
    <!-- Title -->
    <h2 class="text-center mb-4 text-uppercase text-primary">User Bookings</h2>

    {% if bookings %}
    <div class="row g-4">
        {% for booking in bookings %}
        <div class="col-md-6 col-lg-4">
            <!-- Card -->
            <div class="card shadow-lg h-100 border-0 rounded-lg overflow-hidden">
                <!-- Card Image -->
                <div class="position-relative">
                    <img src="{{ booking.tennis_court.ImageURL }}" 
                         alt="{{ booking.tennis_court.name }}" 
                         class="card-img-top" 
                         style="height: 220px; object-fit: cover;">
                    <div class="position-absolute top-0 end-0 p-2">
                        <span class="badge bg-success shadow-sm fs-6 px-3 py-2">{% if booking.tennis_court.price == 0 %}Free{% else %}${{ booking.tennis_court.price }}{% endif %}</span>
                    </div>
                </div>

                <!-- Card Body -->
                <div class="card-body d-flex flex-column bg-light">
                    <!-- Court Name -->
                    <h5 class="card-title text-dark fw-bold">{{ booking.tennis_court.name }}</h5>
                    
                    <!-- Booking Info -->
                    <ul class="list-unstyled text-muted mb-4">
                        <li><i class="bi bi-people-fill me-2 text-primary"></i> <strong>Limit:</strong> {{ booking.tennis_court.limit }} people</li>
                        <li><i class="bi bi-geo-alt-fill me-2 text-primary"></i> <strong>Address:</strong> {{ booking.tennis_court.court_address }}</li>
                        <li><i class="bi bi-calendar-check me-2 text-primary"></i> <strong>Play Time:</strong> {{ booking.play_time }}</li>
                        <li><i class="bi bi-person-circle me-2 text-primary"></i> <strong>By:</strong> {{ booking.user.username }}</li>
                    </ul>

                    <!-- Button Container -->
                    <form method="POST" class="mt-auto">
                        {% csrf_token %}
                        <input type="hidden" name="booking_id" value="{{ booking.id }}">
                        <label for="play_time_{{ booking.id }}" class="form-label small">Play Time:</label>
                        <select name="play_time" id="play_time_{{ booking.id }}" class="form-select mb-2">
                          {% for time in booking.tennis_court.available_times %}
                            <option value="{{ time }}" {% if time == booking.play_time %}selected{% endif %}>
                              {{ time }}
                            </option>
                          {% endfor %}
                        </select>
                        <div class="d-flex gap-2">
                          <button type="submit" name="edit" class="btn btn-primary btn-sm flex-grow-1" onclick="return confirmUpdate();">Update</button>
                          <button type="submit" name="cancel" class="btn btn-danger btn-sm flex-grow-1" onclick="return confirmCancel();">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-muted">No bookings available.</p>
    {% endif %}

    <!-- Confirmation Script -->
    <script>
        function confirmCancel() {
            return confirm("Do you really want to cancel this booking?");
        }
    </script>
</div>
{% endblock %}
